name: Add Contributor

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'GitHub username of the contributor'
        required: true
        type: string
      contribution:
        description: 'Type of contribution'
        required: true
        type: choice
        options:
          - bug        # Bug reports
          - code       # Code contributions
          - doc        # Documentation
          - design     # Design
          - ideas      # Ideas and planning
          - infra      # Infrastructure (CI/CD, build tools)
          - maintenance # Maintenance
          - review     # Reviewing pull requests
          - test       # Writing tests
          - translation # Translation
          - question   # Answering questions
          - tutorial   # Tutorials
          - talk       # Talks
          - video      # Videos
          - example    # Examples
          - blog       # Blogposts
          - financial  # Financial support
          - fundingFinding # Funding/Grant finders
          - content    # Content
          - data       # Data
          - eventOrganizing # Event organizing
          - platform   # Platform support
          - plugin     # Plugin/utility libraries
          - projectManagement # Project management
          - research   # Research
          - security   # Security
          - tool       # Tools
          - userTesting # User testing
      pr_number:
        description: 'Related PR/Issue number (optional)'
        required: false
        type: string

jobs:
  add-contributor:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add contributor
        run: |
          npm run contributors:add -- ${{ inputs.username }} ${{ inputs.contribution }}

      - name: Generate contributors list
        run: npm run contributors:generate

      - name: Create branch name
        id: branch
        run: |
          BRANCH_NAME="contributors/add-${{ inputs.username }}-$(date +%s)"
          echo "name=$BRANCH_NAME" >> $GITHUB_OUTPUT

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: |
            docs: Add @${{ inputs.username }} as contributor

            Added @${{ inputs.username }} for ${{ inputs.contribution }} contributions.
            ${{ inputs.pr_number && format('Related: #{0}', inputs.pr_number) || '' }}

            ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

            Co-Authored-By: Claude <noreply@anthropic.com>
          branch: ${{ steps.branch.outputs.name }}
          delete-branch: true
          title: "docs: Add @${{ inputs.username }} as contributor"
          body: |
            ## Adding Contributor

            This PR adds **@${{ inputs.username }}** to our contributors list.

            **Contribution type:** `${{ inputs.contribution }}`
            ${{ inputs.pr_number && format('**Related:** #{0}', inputs.pr_number) || '' }}

            ### Changes
            - Updated `.all-contributorsrc` with new contributor
            - Regenerated contributors table in README.md
            - Updated contributor count badge

            ### Contribution Types Reference
            - ğŸ› `bug` - Bug reports
            - ğŸ’» `code` - Code contributions
            - ğŸ“– `doc` - Documentation
            - ğŸ¨ `design` - Design
            - ğŸ¤” `ideas` - Ideas and planning
            - ğŸš‡ `infra` - Infrastructure (CI/CD)
            - ğŸš§ `maintenance` - Maintenance
            - ğŸ‘€ `review` - Reviewing pull requests
            - âš ï¸ `test` - Writing tests

            Thank you @${{ inputs.username }} for your contribution! ğŸ‰

            ---

            ğŸ¤– This PR was automatically generated by the Add Contributor workflow.
          labels: |
            documentation
            contributors

      - name: PR Summary
        if: steps.cpr.outputs.pull-request-number
        run: |
          echo "âœ… Pull Request created successfully!"
          echo "PR Number: ${{ steps.cpr.outputs.pull-request-number }}"
          echo "PR URL: ${{ steps.cpr.outputs.pull-request-url }}"
          echo ""
          echo "Added @${{ inputs.username }} for: ${{ inputs.contribution }}"
