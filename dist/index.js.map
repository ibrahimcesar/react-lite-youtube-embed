{"version":3,"file":"index.js","sources":["../src/lib/useYoutubeThumbnail.tsx","../src/lib/index.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\n\nexport type imgResolution =\n  | \"default\"\n  | \"mqdefault\"\n  | \"hqdefault\"\n  | \"sddefault\"\n  | \"maxresdefault\";\n\nconst expectedWidths: Record<imgResolution, number> = {\n  default: 120,\n  mqdefault: 320,\n  hqdefault: 480,\n  sddefault: 640,\n  maxresdefault: 1280,\n};\n\nexport const useYoutubeThumbnail = (\n  videoId: string,\n  vi: string,\n  format: string,\n  imageRes: imgResolution = \"maxresdefault\"\n) => {\n  const [url, setUrl] = useState(\"\");\n\n  useEffect(() => {\n    const testUrl = `https://img.youtube.com/${vi}/${videoId}/${imageRes}.${format}`;\n    const fallbackUrl = `https://img.youtube.com/${vi}/${videoId}/hqdefault.${format}`;\n\n    const expectedWidth = expectedWidths[imageRes];\n\n    const img = new Image();\n    img.onload = () => {\n      if (img.width < expectedWidth) {\n        setUrl(fallbackUrl);\n      } else {\n        setUrl(testUrl);\n      }\n    };\n    img.onerror = () => setUrl(fallbackUrl);\n    img.src = testUrl;\n  }, [videoId, vi, format, imageRes]);\n\n  return url;\n};\n\nexport default useYoutubeThumbnail;\n","import * as React from \"react\";\nimport useYoutubeThumbnail from \"./useYoutubeThumbnail\";\nimport { imgResolution } from \"./useYoutubeThumbnail\";\n\nexport interface LiteYouTubeProps {\n  announce?: string;\n  id: string;\n  title: string;\n  activatedClass?: string;\n  adNetwork?: boolean;\n  aspectHeight?: number;\n  aspectWidth?: number;\n  iframeClass?: string;\n  /** @deprecated Use cookie prop instead */\n  noCookie?: boolean;\n  cookie?: boolean;\n  enableJsApi?: boolean;\n  alwaysLoadIframe?: boolean;\n  params?: string;\n  playerClass?: string;\n  playlist?: boolean;\n  playlistCoverId?: string;\n  poster?: imgResolution;\n  webp?: boolean;\n  wrapperClass?: string;\n  onIframeAdded?: () => void;\n  muted?: boolean;\n  autoplay?: boolean;\n  thumbnail?: string;\n  rel?: string;\n  containerElement?: keyof React.JSX.IntrinsicElements;\n  style?: React.CSSProperties;\n  focusOnLoad?: boolean;\n  referrerPolicy?: React.HTMLAttributeReferrerPolicy;\n}\n\nfunction LiteYouTubeEmbedComponent(\n  props: LiteYouTubeProps,\n  ref: React.Ref<HTMLIFrameElement>,\n) {\n  const [preconnected, setPreconnected] = React.useState(false);\n  const [iframe, setIframe] = React.useState(props.alwaysLoadIframe || false);\n  const videoId = encodeURIComponent(props.id);\n  const videoPlaylistCoverId =\n    typeof props.playlistCoverId === \"string\"\n      ? encodeURIComponent(props.playlistCoverId)\n      : null;\n  const videoTitle = props.title;\n  const posterImp = props.poster || \"hqdefault\";\n  const announceWatch = props.announce || \"Watch\";\n\n  const shouldAddAutoplayParam = props.alwaysLoadIframe\n    ? props.autoplay && props.muted\n    : true; // When the iframe is not loaded immediately, the video should play as soon as its loaded (which happens when the button is clicked)\n\n  // Iframe Parameters - memoized to avoid recreating URLSearchParams on every render\n  const iframeParams = React.useMemo(() => {\n    const params = new URLSearchParams({\n      ...(props.muted ? { mute: \"1\" } : {}),\n      ...(shouldAddAutoplayParam ? { autoplay: \"1\" } : {}),\n      ...(props.enableJsApi ? { enablejsapi: \"1\" } : {}),\n      ...(props.playlist ? { list: videoId } : {}),\n    });\n\n    // parse props.params into individual search parameters and append them to params\n    if (props.params) {\n      const additionalParams = new URLSearchParams(\n        props.params.startsWith(\"&\") ? props.params.slice(1) : props.params,\n      );\n      additionalParams.forEach((value, key) => {\n        params.append(key, value);\n      });\n    }\n\n    return params;\n  }, [props.muted, shouldAddAutoplayParam, props.enableJsApi, props.playlist, videoId, props.params]);\n\n  const ytUrl = React.useMemo(\n    () => props.cookie\n      ? \"https://www.youtube.com\"\n      : \"https://www.youtube-nocookie.com\",\n    [props.cookie]\n  );\n\n  const iframeSrc = React.useMemo(\n    () => !props.playlist\n      ? `${ytUrl}/embed/${videoId}?${iframeParams.toString()}`\n      : `${ytUrl}/embed/videoseries?${iframeParams.toString()}`,\n    [props.playlist, ytUrl, videoId, iframeParams]\n  );\n\n  const useDynamicThumbnail =\n    !props.thumbnail && !props.playlist && posterImp === \"maxresdefault\";\n\n  const format = props.webp ? \"webp\" : \"jpg\";\n  const vi = props.webp ? \"vi_webp\" : \"vi\";\n\n  const dynamicThumbnailUrl = useDynamicThumbnail\n    ? useYoutubeThumbnail(props.id, vi, format, posterImp)\n    : null;\n\n  const posterUrl = React.useMemo(\n    () => props.thumbnail ||\n      dynamicThumbnailUrl ||\n      `https://i.ytimg.com/${vi}/${\n        props.playlist ? videoPlaylistCoverId : videoId\n      }/${posterImp}.${format}`,\n    [props.thumbnail, dynamicThumbnailUrl, vi, props.playlist, videoPlaylistCoverId, videoId, posterImp, format]\n  );\n\n  const activatedClassImp = props.activatedClass || \"lyt-activated\";\n  const adNetworkImp = props.adNetwork || false;\n  const aspectHeight = props.aspectHeight || 9;\n  const aspectWidth = props.aspectWidth || 16;\n  const iframeClassImp = props.iframeClass || \"\";\n  const playerClassImp = props.playerClass || \"lty-playbtn\";\n  const wrapperClassImp = props.wrapperClass || \"yt-lite\";\n  const onIframeAdded = React.useCallback(\n    props.onIframeAdded || function () {},\n    [props.onIframeAdded]\n  );\n  const rel = props.rel ? \"prefetch\" : \"preload\";\n  const ContainerElement = props.containerElement || \"article\";\n  const style = props.style || {};\n\n  const warmConnections = () => {\n    if (preconnected) return;\n    setPreconnected(true);\n  };\n\n  const addIframe = () => {\n    if (iframe) return;\n    setIframe(true);\n  };\n\n  React.useEffect(() => {\n    if (iframe) {\n      onIframeAdded();\n\n      // Focus iframe if focusOnLoad is enabled and ref is available\n      if (props.focusOnLoad && typeof ref === 'object' && ref?.current) {\n        ref.current.focus();\n      }\n    }\n  }, [iframe, onIframeAdded, props.focusOnLoad, ref]);\n\n  return (\n    <>\n      <link rel={rel} href={posterUrl} as=\"image\" />\n      <>\n        {preconnected && (\n          <>\n            <link rel=\"preconnect\" href={ytUrl} />\n            <link rel=\"preconnect\" href=\"https://www.google.com\" />\n            {adNetworkImp && (\n              <>\n                <link rel=\"preconnect\" href=\"https://static.doubleclick.net\" />\n                <link\n                  rel=\"preconnect\"\n                  href=\"https://googleads.g.doubleclick.net\"\n                />\n              </>\n            )}\n          </>\n        )}\n      </>\n      <ContainerElement\n        onPointerOver={warmConnections}\n        onClick={addIframe}\n        className={`${wrapperClassImp} ${iframe ? activatedClassImp : \"\"}`}\n        data-title={videoTitle}\n        role={!iframe ? \"img\" : undefined}\n        aria-label={!iframe ? `${videoTitle} - YouTube video preview` : undefined}\n        style={{\n          backgroundImage: `url(${posterUrl})`,\n          ...({\n            \"--aspect-ratio\": `${(aspectHeight / aspectWidth) * 100}%`,\n          } as React.CSSProperties),\n          ...style,\n        }}\n      >\n        <button\n          type=\"button\"\n          className={playerClassImp}\n          aria-label={`${announceWatch} ${videoTitle}`}\n          aria-hidden={iframe || undefined}\n          tabIndex={iframe ? -1 : 0}\n        >\n          <span className=\"lty-visually-hidden\">\n            {announceWatch}\n          </span>\n        </button>\n        {iframe && (\n          <iframe\n            ref={ref}\n            className={iframeClassImp}\n            title={videoTitle}\n            width=\"560\"\n            height=\"315\"\n            style={{ border: 0 }}\n            allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n            allowFullScreen\n            src={iframeSrc}\n            referrerPolicy={props.referrerPolicy || \"strict-origin-when-cross-origin\"}\n          ></iframe>\n        )}\n      </ContainerElement>\n    </>\n  );\n}\n\nexport default React.forwardRef<HTMLIFrameElement, LiteYouTubeProps>(\n  LiteYouTubeEmbedComponent,\n);\n"],"names":["expectedWidths","useYoutubeThumbnail","videoId","vi","format","imageRes","url","setUrl","useState","useEffect","testUrl","fallbackUrl","expectedWidth","img","LiteYouTubeEmbedComponent","props","ref","preconnected","setPreconnected","React","iframe","setIframe","videoPlaylistCoverId","videoTitle","posterImp","announceWatch","shouldAddAutoplayParam","iframeParams","params","value","key","ytUrl","iframeSrc","useDynamicThumbnail","dynamicThumbnailUrl","posterUrl","activatedClassImp","adNetworkImp","aspectHeight","aspectWidth","iframeClassImp","playerClassImp","wrapperClassImp","onIframeAdded","rel","ContainerElement","style","warmConnections","addIframe","jsxs","Fragment","jsx"],"mappings":"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"}