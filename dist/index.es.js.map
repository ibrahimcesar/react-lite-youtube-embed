{"version":3,"file":"index.es.js","sources":["../src/lib/useYoutubeThumbnail.tsx","../src/lib/index.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\n\nexport type imgResolution =\n  | \"default\"\n  | \"mqdefault\"\n  | \"hqdefault\"\n  | \"sddefault\"\n  | \"maxresdefault\";\n\nconst expectedWidths: Record<imgResolution, number> = {\n  default: 120,\n  mqdefault: 320,\n  hqdefault: 480,\n  sddefault: 640,\n  maxresdefault: 1280,\n};\n\nexport const useYoutubeThumbnail = (\n  videoId: string,\n  vi: string,\n  format: string,\n  imageRes: imgResolution = \"maxresdefault\"\n) => {\n  const [url, setUrl] = useState(\"\");\n\n  useEffect(() => {\n    const testUrl = `https://img.youtube.com/${vi}/${videoId}/${imageRes}.${format}`;\n    const fallbackUrl = `https://img.youtube.com/${vi}/${videoId}/hqdefault.${format}`;\n\n    const expectedWidth = expectedWidths[imageRes];\n\n    const img = new Image();\n    img.onload = () => {\n      if (img.width < expectedWidth) {\n        setUrl(fallbackUrl);\n      } else {\n        setUrl(testUrl);\n      }\n    };\n    img.onerror = () => setUrl(fallbackUrl);\n    img.src = testUrl;\n  }, [videoId, vi, format, imageRes]);\n\n  return url;\n};\n\nexport default useYoutubeThumbnail;\n","import * as React from \"react\";\nimport useYoutubeThumbnail from \"./useYoutubeThumbnail\";\nimport { imgResolution } from \"./useYoutubeThumbnail\";\n\nexport interface LiteYouTubeProps {\n  announce?: string;\n  id: string;\n  title: string;\n  activatedClass?: string;\n  adNetwork?: boolean;\n  aspectHeight?: number;\n  aspectWidth?: number;\n  iframeClass?: string;\n  /** @deprecated Use cookie prop instead */\n  noCookie?: boolean;\n  cookie?: boolean;\n  enableJsApi?: boolean;\n  alwaysLoadIframe?: boolean;\n  params?: string;\n  playerClass?: string;\n  playlist?: boolean;\n  playlistCoverId?: string;\n  poster?: imgResolution;\n  webp?: boolean;\n  wrapperClass?: string;\n  onIframeAdded?: () => void;\n  muted?: boolean;\n  autoplay?: boolean;\n  thumbnail?: string;\n  rel?: string;\n  containerElement?: keyof React.JSX.IntrinsicElements;\n  style?: React.CSSProperties;\n  focusOnLoad?: boolean;\n  referrerPolicy?: React.HTMLAttributeReferrerPolicy;\n}\n\nfunction LiteYouTubeEmbedComponent(\n  props: LiteYouTubeProps,\n  ref: React.Ref<HTMLIFrameElement>,\n) {\n  const [preconnected, setPreconnected] = React.useState(false);\n  const [iframe, setIframe] = React.useState(props.alwaysLoadIframe || false);\n  const videoId = encodeURIComponent(props.id);\n  const videoPlaylistCoverId =\n    typeof props.playlistCoverId === \"string\"\n      ? encodeURIComponent(props.playlistCoverId)\n      : null;\n  const videoTitle = props.title;\n  const posterImp = props.poster || \"hqdefault\";\n  const announceWatch = props.announce || \"Watch\";\n\n  const shouldAddAutoplayParam = props.alwaysLoadIframe\n    ? props.autoplay && props.muted\n    : true; // When the iframe is not loaded immediately, the video should play as soon as its loaded (which happens when the button is clicked)\n\n  // Iframe Parameters - memoized to avoid recreating URLSearchParams on every render\n  const iframeParams = React.useMemo(() => {\n    const params = new URLSearchParams({\n      ...(props.muted ? { mute: \"1\" } : {}),\n      ...(shouldAddAutoplayParam ? { autoplay: \"1\" } : {}),\n      ...(props.enableJsApi ? { enablejsapi: \"1\" } : {}),\n      ...(props.playlist ? { list: videoId } : {}),\n    });\n\n    // parse props.params into individual search parameters and append them to params\n    if (props.params) {\n      const additionalParams = new URLSearchParams(\n        props.params.startsWith(\"&\") ? props.params.slice(1) : props.params,\n      );\n      additionalParams.forEach((value, key) => {\n        params.append(key, value);\n      });\n    }\n\n    return params;\n  }, [props.muted, shouldAddAutoplayParam, props.enableJsApi, props.playlist, videoId, props.params]);\n\n  const ytUrl = React.useMemo(\n    () => props.cookie\n      ? \"https://www.youtube.com\"\n      : \"https://www.youtube-nocookie.com\",\n    [props.cookie]\n  );\n\n  const iframeSrc = React.useMemo(\n    () => !props.playlist\n      ? `${ytUrl}/embed/${videoId}?${iframeParams.toString()}`\n      : `${ytUrl}/embed/videoseries?${iframeParams.toString()}`,\n    [props.playlist, ytUrl, videoId, iframeParams]\n  );\n\n  const useDynamicThumbnail =\n    !props.thumbnail && !props.playlist && posterImp === \"maxresdefault\";\n\n  const format = props.webp ? \"webp\" : \"jpg\";\n  const vi = props.webp ? \"vi_webp\" : \"vi\";\n\n  const dynamicThumbnailUrl = useDynamicThumbnail\n    ? useYoutubeThumbnail(props.id, vi, format, posterImp)\n    : null;\n\n  const posterUrl = React.useMemo(\n    () => props.thumbnail ||\n      dynamicThumbnailUrl ||\n      `https://i.ytimg.com/${vi}/${\n        props.playlist ? videoPlaylistCoverId : videoId\n      }/${posterImp}.${format}`,\n    [props.thumbnail, dynamicThumbnailUrl, vi, props.playlist, videoPlaylistCoverId, videoId, posterImp, format]\n  );\n\n  const activatedClassImp = props.activatedClass || \"lyt-activated\";\n  const adNetworkImp = props.adNetwork || false;\n  const aspectHeight = props.aspectHeight || 9;\n  const aspectWidth = props.aspectWidth || 16;\n  const iframeClassImp = props.iframeClass || \"\";\n  const playerClassImp = props.playerClass || \"lty-playbtn\";\n  const wrapperClassImp = props.wrapperClass || \"yt-lite\";\n  const onIframeAdded = React.useCallback(\n    props.onIframeAdded || function () {},\n    [props.onIframeAdded]\n  );\n  const rel = props.rel ? \"prefetch\" : \"preload\";\n  const ContainerElement = props.containerElement || \"article\";\n  const style = props.style || {};\n\n  const warmConnections = () => {\n    if (preconnected) return;\n    setPreconnected(true);\n  };\n\n  const addIframe = () => {\n    if (iframe) return;\n    setIframe(true);\n  };\n\n  React.useEffect(() => {\n    if (iframe) {\n      onIframeAdded();\n\n      // Focus iframe if focusOnLoad is enabled and ref is available\n      if (props.focusOnLoad && typeof ref === 'object' && ref?.current) {\n        ref.current.focus();\n      }\n    }\n  }, [iframe, onIframeAdded, props.focusOnLoad, ref]);\n\n  return (\n    <>\n      <link rel={rel} href={posterUrl} as=\"image\" />\n      <>\n        {preconnected && (\n          <>\n            <link rel=\"preconnect\" href={ytUrl} />\n            <link rel=\"preconnect\" href=\"https://www.google.com\" />\n            {adNetworkImp && (\n              <>\n                <link rel=\"preconnect\" href=\"https://static.doubleclick.net\" />\n                <link\n                  rel=\"preconnect\"\n                  href=\"https://googleads.g.doubleclick.net\"\n                />\n              </>\n            )}\n          </>\n        )}\n      </>\n      <ContainerElement\n        onPointerOver={warmConnections}\n        onClick={addIframe}\n        className={`${wrapperClassImp} ${iframe ? activatedClassImp : \"\"}`}\n        data-title={videoTitle}\n        role={!iframe ? \"img\" : undefined}\n        aria-label={!iframe ? `${videoTitle} - YouTube video preview` : undefined}\n        style={{\n          backgroundImage: `url(${posterUrl})`,\n          ...({\n            \"--aspect-ratio\": `${(aspectHeight / aspectWidth) * 100}%`,\n          } as React.CSSProperties),\n          ...style,\n        }}\n      >\n        <button\n          type=\"button\"\n          className={playerClassImp}\n          aria-label={`${announceWatch} ${videoTitle}`}\n          aria-hidden={iframe || undefined}\n          tabIndex={iframe ? -1 : 0}\n        >\n          <span className=\"lty-visually-hidden\">\n            {announceWatch}\n          </span>\n        </button>\n        {iframe && (\n          <iframe\n            ref={ref}\n            className={iframeClassImp}\n            title={videoTitle}\n            width=\"560\"\n            height=\"315\"\n            style={{ border: 0 }}\n            allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n            allowFullScreen\n            src={iframeSrc}\n            referrerPolicy={props.referrerPolicy || \"strict-origin-when-cross-origin\"}\n          ></iframe>\n        )}\n      </ContainerElement>\n    </>\n  );\n}\n\nexport default React.forwardRef<HTMLIFrameElement, LiteYouTubeProps>(\n  LiteYouTubeEmbedComponent,\n);\n"],"names":["expectedWidths","useYoutubeThumbnail","videoId","vi","format","imageRes","url","setUrl","useState","useEffect","testUrl","fallbackUrl","expectedWidth","img","LiteYouTubeEmbedComponent","props","ref","preconnected","setPreconnected","React","iframe","setIframe","videoPlaylistCoverId","videoTitle","posterImp","announceWatch","shouldAddAutoplayParam","iframeParams","params","value","key","ytUrl","iframeSrc","useDynamicThumbnail","dynamicThumbnailUrl","posterUrl","activatedClassImp","adNetworkImp","aspectHeight","aspectWidth","iframeClassImp","playerClassImp","wrapperClassImp","onIframeAdded","rel","ContainerElement","style","warmConnections","addIframe","jsxs","Fragment","jsx","index"],"mappings":"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"}